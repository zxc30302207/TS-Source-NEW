const { EmbedBuilder } = require('discord.js');

// 設定你的紀錄伺服器和頻道 ID
const LOG_GUILD_ID = '1397321161163018262';
const LOG_CHANNEL_ID = '1398423678206611466';

async function sendLog(client, embed) {
  try {
    const logGuild = await client.guilds.fetch(LOG_GUILD_ID);
    const logChannel = await logGuild.channels.fetch(LOG_CHANNEL_ID);
    if (logChannel?.isTextBased?.()) {
      await logChannel.send({ embeds: [embed] });
    }
  } catch (err) {
    console.error('❌ 發送日誌失敗：', err);
  }
}

module.exports = {
  logGuildJoin: async (client, guild) => {
    const inviter = guild.members.cache.find(m => m.permissions.has('Administrator'))?.user;

    const embed = new EmbedBuilder()
      .setTitle('📲 機器人加入了伺服器')
      .addFields(
        { name: '伺服器名稱', value: guild.name, inline: true },
        { name: '伺服器 ID', value: guild.id, inline: true },
        { name: '邀請者名稱', value: inviter?.tag || '未知', inline: true },
        { name: '邀請者 ID', value: inviter?.id || '未知', inline: true }
      )
      .setTimestamp()
      .setColor(0x00cc99);

    sendLog(client, embed);
  },

  logGuildLeave: async (client, guild) => {
    const embed = new EmbedBuilder()
      .setTitle('📲 機器人離開了伺服器')
      .addFields(
        { name: '伺服器名稱', value: guild.name, inline: true },
        { name: '伺服器 ID', value: guild.id, inline: true },
        { name: '邀請者名稱', value: '未知', inline: true },
        { name: '邀請者 ID', value: '未知', inline: true }
      )
      .setTimestamp()
      .setColor(0xcc3333);

    sendLog(client, embed);
  },

  logSlashCommand: async (client, interaction) => {
    const embed = new EmbedBuilder()
      .setTitle('⌨️ 使用指令')
      .addFields(
        { name: '指令', value: `/${interaction.commandName}`, inline: true },
        { name: '使用者名稱', value: interaction.user.tag, inline: true },
        { name: '使用者 ID', value: interaction.user.id, inline: true },
        { name: '伺服器名稱', value: interaction.guild?.name || 'DM', inline: true },
        { name: '伺服器 ID', value: interaction.guild?.id || 'DM', inline: true }
      )
      .setTimestamp()
      .setColor(0x3399ff);

    sendLog(client, embed);
  },

  logTextCommand: async (client, message, commandName) => {
    const embed = new EmbedBuilder()
      .setTitle('⌨️ 使用指令')
      .addFields(
        { name: '指令', value: commandName, inline: true },
        { name: '使用者名稱', value: message.author.tag, inline: true },
        { name: '使用者 ID', value: message.author.id, inline: true },
        { name: '伺服器名稱', value: message.guild?.name || 'DM', inline: true },
        { name: '伺服器 ID', value: message.guild?.id || 'DM', inline: true }
      )
      .setTimestamp()
      .setColor(0x3399ff);

    sendLog(client, embed);
  },

 logChat: async (client, user, content, source) => {
  // source 可以是 message、interaction 或 guild
  let guild;
  if (source?.guild) guild = source.guild; // message 或 interaction
  else if (source?.name && source?.id) guild = source; // guild 物件
  else guild = null;

  const embed = new EmbedBuilder()
    .setTitle('🗣️ 機器人對話')
    .addFields(
      { name: '內容', value: content || '（無內容）', inline: false },
      { name: '使用者名稱', value: user.tag, inline: true },
      { name: '使用者 ID', value: user.id, inline: true },
      { name: '伺服器名稱', value: guild?.name || 'DM', inline: true },
      { name: '伺服器 ID', value: guild?.id || 'DM', inline: true }
    )
    .setTimestamp()
    .setColor(0xffcc00);

  sendLog(client, embed);
 }
};